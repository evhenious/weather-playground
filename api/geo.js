const http=require("http"),{GEO_DB_BASE_URL}=process.env;async function processRequest(n,t){const{url:a,params:c={}}=n.query,s=JSON.parse(c),o=Object.keys(s).reduce((r,e)=>r+=`${r.length?"&":"?"}${e}=${s[e]}`,"");try{const r=await getGeoData(a,o);t.json(r)}catch(r){t.status(500).json({error:r})}}function getGeoData(n="",t=""){const a=`${GEO_DB_BASE_URL}${n}${t}`;return console.log("Calling:",a),new Promise((c,s)=>{http.get(a,o=>{let r="";o.on("data",e=>{r+=e}),o.on("end",()=>{try{const e=JSON.parse(r);c(e)}catch(e){console.error(e.message),s("Error parsing GeoDB response")}})}).on("error",o=>{console.error("Error: ",o.message),s("Cannot get GeoDB data")})})}module.exports=processRequest;
