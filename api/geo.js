"use strict";import p from"http";const{GEO_DB_BASE_URL:m=""}=process.env;async function i(n,o){const{url:s,params:c=""}=n.query,t=JSON.parse(c),e=new URLSearchParams;Object.entries(t).forEach(([r,a])=>{e.set(r,a)});try{const r=await l(s,e);o.json(r)}catch(r){o.status(500).json({error:r})}}function l(n="",o){const s=`${m}${n}?${o}`;return console.log("/api/geo: Calling:",s),new Promise((c,t)=>{p.get(s,e=>{let r="";e.on("data",a=>{r+=a}),e.on("end",()=>{try{const a=JSON.parse(r);c(a)}catch(a){console.error(a.message),t("Error parsing GeoDB response")}})}).on("error",e=>{console.error("Error: ",e.message),t("Cannot get GeoDB data")})})}module.exports=i;
